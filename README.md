# 食品栄養計算システム v2.2

過去1週間の食事データから栄養摂取量を計算し、目標値との充足率を視覚的に表示するWebアプリケーションです。

## 🎯 主な機能

### ✨ **v2.2の新機能**
- 🔧 **食事の編集機能**: 保存した食事を後から修正可能
- 🗑️ **食事の削除機能**: 不要な食事データを削除
- 👥 **人物プルダウン選択**: 既存の人物名から簡単に選択
- 🤖 **DeepSeek AI統合**: 高速・低コストのAIマッチング

### 📊 栄養管理機能
- **食事記録**: 日付、個人名、食品を入力して記録
- **高速あいまい検索**: 4段階マッチング + AI補助
- **栄養価計算**: 31種類の栄養素を自動計算
- **週間サマリー**: 過去7日間の1日あたり平均摂取量を表示
- **充足率表示**: レーダーチャート、プログレスバーで視覚化
- **食事履歴**: 過去30日間の食事記録を表示・編集・削除

## 📝 使い方

### 食品の入力方法

```
納豆45g、ご飯160g、生卵60g、つゆ1.5g
```

### 人物の選択

1. **既存の人物**: プルダウンから選択
2. **新規の人物**: 「新規入力...」を選択して名前を入力

### 食事の編集

1. 食事履歴で編集したい食事の **✏️** ボタンをクリック
2. 内容を修正
3. 「更新」ボタンをクリック

### 食事の削除

1. 食事履歴で削除したい食事の **🗑️** ボタンをクリック
2. 確認ダイアログで「OK」

## 🤖 AI検索機能

### DeepSeek Chat（デフォルト）
- **特徴**: 高速・低コスト
- **コスト**: $0.14/1M入力トークン
- **設定**: `DEEPSEEK_API_KEY`環境変数

### Claude（フォールバック）
- **特徴**: 高精度
- **コスト**: 高め
- **設定**: `CLAUDE_API_KEY`環境変数（オプション）

### AIなしモード
- APIキーを設定しなくても動作
- 4段階あいまい検索のみ使用

## 対応栄養素（31種類）

### エネルギー・主要栄養素
- エネルギー、たんぱく質、脂質、食物繊維総量

### ミネラル（16種類）
- カリウム、カルシウム、マグネシウム、リン
- 鉄、亜鉛、銅、マンガン
- ヨウ素、セレン、クロム、モリブデン

### ビタミン（13種類）
- ビタミンA、D、E、K
- ビタミンB1、B2、ナイアシン、B6、B12
- 葉酸、パントテン酸、ビオチン、C

### その他
- 食塩相当量

## 📊 データベース

- **データソース**: 文部科学省「日本食品標準成分表（八訂）増補2023年」
- **収録食品数**: 2,538品目
- **検索方式**: 4段階あいまい検索 + AI補助

## 🚀 セットアップ

### 必要な環境変数

```bash
APP_PASSWORD=your_app_password_here
SECRET_KEY=your_secret_key_here
DEEPSEEK_API_KEY=sk-xxxxx  # オプション（推奨）
CLAUDE_API_KEY=sk-ant-xxxxx  # オプション
```

### ローカル実行

```bash
# 依存パッケージのインストール
pip install -r requirements.txt

# アプリケーション起動
python app.py
```

ブラウザで `http://localhost:5000` にアクセス

### テスト実行

```bash
# 食品検索機能のテスト
python test_search.py

# データベースのテスト
python test_local.py
```

## 🎯 目標摂取量

成人男性の推奨値:
- エネルギー: 2,700kcal
- たんぱく質: 70g
- カルシウム: 750mg
- 鉄: 7.5mg
- ビタミンC: 100mg
など、全31項目

## 📱 使用手順

### 1. ログイン
設定したパスワードでログイン

### 2. 食事を記録
```
個人名: 山田太郎（またはプルダウンから選択）
日付: 2024-11-23
時刻: 07:30
食品: 納豆45g、ご飯160g、生卵60g
```

### 3. 自動計算
- AIが食品名を自動マッチング（DeepSeek使用）
- 31種類の栄養素を計算
- データベースに保存

### 4. 週間サマリー表示
- 過去7日間の平均を自動計算
- レーダーチャートで可視化
- 充足率を色分け表示

### 5. 食事の管理
- 📝 履歴を確認
- ✏️ 内容を編集
- 🗑️ 不要な記録を削除

## 🔧 技術スタック

- **バックエンド**: Flask (Python 3.11)
- **AI**: DeepSeek Chat + Claude (オプション)
- **あいまい検索**: difflib + キーワードマッピング
- **データベース**: SQLite
- **フロントエンド**: HTML, TailwindCSS, Chart.js
- **デプロイ**: Render

## ✅ バージョン履歴

### v2.2 (最新)
- 🔧 食事の編集機能
- 🗑️ 食事の削除機能
- 👥 人物プルダウン選択
- 🤖 DeepSeek AI統合

### v2.1
- 🐛 データベース初期化エラー修正

### v2.0
- ✨ AIを使わない高速検索
- 🚀 Claude API不要（コスト$0）

## 💰 コスト

### 推奨構成（DeepSeek使用）
- **Render無料プラン**: $0/月
- **DeepSeek API**: 約$0.01/月（100回検索想定）
- **合計**: 約$0.01/月 🎉

### 完全無料構成（AIなし）
- **Render無料プラン**: $0/月
- **AI API**: 使用しない
- **合計**: $0/月 🎉

### 高精度構成（Claude使用）
- **Render**: $0-7/月
- **Claude API**: $1-5/月
- **合計**: $1-12/月

## 📂 ファイル構成

```
nutrition-calculator/
├── app.py                    # メインアプリケーション
├── food_database.json        # 食品データベース（2,538品目）
├── templates/
│   └── index.html           # フロントエンドUI
├── requirements.txt          # Pythonパッケージ
├── render.yaml              # Render設定
├── Procfile                 # Gunicorn設定
├── test_search.py           # 検索機能テスト
├── test_local.py            # ローカルテスト
├── README.md
├── SETUP.md                 # デプロイ手順
├── EXAMPLES.md              # 使用例
├── CHANGELOG.md             # 変更履歴
└── TROUBLESHOOTING.md       # トラブルシューティング
```

## 🔐 セキュリティ

- パスワード認証機能
- セッション管理
- 環境変数で機密情報を管理
- .gitignoreで保護

## 📞 トラブルシューティング

詳細は `TROUBLESHOOTING.md` を参照

### よくある質問

**Q: 食事を編集できない**
A: 編集ボタン（✏️）をクリックしてモーダルから編集してください

**Q: DeepSeek APIキーはどこで取得？**
A: https://platform.deepseek.com/ でアカウント作成

**Q: AIなしでも使える？**
A: はい、APIキーなしでも4段階検索で動作します

## 📝 ライセンス

食品成分データは文部科学省「日本食品標準成分表（八訂）増補2023年」を使用しています。

## 🎉 謝辞

- 文部科学省: 食品成分データベース
- DeepSeek: AI検索エンジン
- Anthropic: Claude AI
- Render: ホスティングプラットフォーム
